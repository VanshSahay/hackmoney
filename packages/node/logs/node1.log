

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ” MPC-BASED ORDER SPLITTING SERVER ğŸ”               â•‘
â•‘     Privacy-Preserving DEX Liquidity Coordination             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‚ Loaded existing wallet for node1.veil

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                       WALLET INFORMATION                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Node Name:     node1.veil                                  â•‘
â•‘ Address:       0xE94Aed964d9579E5decf8491B3525CADD3f49919  â•‘
â•‘ Private Key:   0x5eee66f32e6d483899...150b6d297519b12ab64f    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  Keep your private key secure! Anyone with access can control your funds.

Configuration validated successfully

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  MPC SERVER CONFIGURATION                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Node Name:     node1.veil                                  â•‘
â•‘ Party ID:      1                                           â•‘
â•‘ Network:       localhost:3534                              â•‘
â•‘ Wallet:        0xE94Aed964d9579E5decf8491B3525CADD3f49919  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ BLOCKCHAIN                                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Chain ID:      84532                                       â•‘
â•‘ RPC URL:       https://base-sepolia.g.alchemy.com/v2/wfTWOqX-tfO2ahOiD3rCXzscObxKVms-â•‘
â•‘ Settlement:    0x56053B0ed4BB1b493c2B15FFa4BA21AF3d1492E4  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ NETWORK PEERS                                                 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Party 0: node0.veil                                          â•‘
â•‘ Party 1: node1.veil (YOU)                                    â•‘
â•‘ Party 2: node2.veil                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ INITIAL CAPACITIES                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ (none configured)                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â³ Blockchain address for party 0 will be received via P2P
â³ Blockchain address for party 2 will be received via P2P
ğŸ”Œ Using WebSocket for real-time event listening
ğŸ”„ Auto-swap enabled via Uniswap
Starting MPC Server (Party 1)...
âœ… Node registered with Settlement contract: 0xE94Aed964d9579E5decf8491B3525CADD3f49919
WebSocket server listening on port 3534
Error connecting to party 2: AggregateError [ECONNREFUSED]: 
    at internalConnectMultiple (node:net:1134:18)
    at afterConnectMultiple (node:net:1715:7) {
  code: 'ECONNREFUSED',
  [errors]: [
    Error: connect ECONNREFUSED ::1:3145
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -61,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3145
    },
    Error: connect ECONNREFUSED 127.0.0.1:3145
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -61,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3145
    }
  ]
}
Connected to party 0 at ws://localhost:3668
Connected to 1/2 parties
P2P network started for party 1
Starting to listen for IntentCreated events at 0x56053B0ed4BB1b493c2B15FFa4BA21AF3d1492E4
Event listener started
MPC Server started successfully
Connections: 1/2
âœ… Server is running and listening for intents
ğŸ’¡ Press Ctrl+C to stop

Received HANDSHAKE_REQUEST from party 0
Incoming connection from: 127.0.0.1
Identified incoming connection as party 2
Received HANDSHAKE_RESPONSE from party 2
IntentCreated event: {
  intentId: '0x953a61fe9c1f745828942c30caa2081c3702931c142417508c906e8bc76e2c5d',
  user: '0x89fEdB2167197199Fd069122e5351A1C779F91B8',
  amountIn: '1000000000000000'
}

=== New Intent Created ===
Intent ID: 0x953a61fe9c1f745828942c30caa2081c3702931c142417508c906e8bc76e2c5d
Amount In: 1000000000000000
Token In: 0x4200000000000000000000000000000000000006
Token Out: 0x0000000000000000000000000000000000000001
No capacity for 0x4200000000000000000000000000000000000006, attempting to swap from other tokens...

ğŸ¯ Attempting to fulfill requirement:
  Token: 0x4200000000000000000000000000000000000006
  Amount: 333333333333333
  âŒ No suitable source token found for swapping
âŒ Could not swap to obtain 0x4200000000000000000000000000000000000006
No capacity for this token, participating with 0...

=== Starting MPC Protocol ===
Step 1: Secret sharing capacity...
Step 2: Distributing shares...
Step 3: Waiting for shares from other parties...
Received SHARE_DISTRIBUTION from party 0
Received shares from party 0 for intent 0x953a61fe9c1f745828942c30caa2081c3702931c142417508c906e8bc76e2c5d
Received SHARE_DISTRIBUTION from party 2
Received shares from party 2 for intent 0x953a61fe9c1f745828942c30caa2081c3702931c142417508c906e8bc76e2c5d
Step 4: Computing total capacity (on shares)...
Step 5: Checking sufficient capacity...
Received COMPUTATION_ROUND from party 0
Received computation round 1 from party 0
Received COMPUTATION_ROUND from party 2
Received computation round 1 from party 2
Warning: Got 6 unique shares instead of expected 3
Share counts: 60165156946203792019686582412528489275819314866256316260061686302466761942221: 1, 58298012371753622704084071822399718257510599590377697646156534399487049478208: 1, 8464681573228225133505846919291755454842708165369405303148453517441579264118: 1, 101976919005878650549587594985675174139199711995036000937047632710303089109777: 1, 10910745183750511874946522134314837851240092135529413355185602567962191200219: 1, 65974502416166643483879805000081228482931779779619547334992798424298056902181: 1
Shares not replicated (all parties likely have 0 capacity), reconstructing by direct sum
Sufficient capacity: true
Step 6: Computing allocations...
Requesting shares for capacity_1 from party 2
Error in MPC protocol: Error: Timeout waiting for reconstruction response for capacity_1 from party 2
    at MPCServer.waitForReconstructionResponse (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:521:15)
    at async MPCServer.reconstructValue (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:463:34)
    at async MPCServer.runMPCProtocol (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:287:38)
    at async MPCServer.handleIntentCreated (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:222:9)
    at async file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:176:13
    at async BlockchainEventListener.handleIntentCreated (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/blockchain/events.js:100:17)
    at async onLogs (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/blockchain/events.js:65:25)
Cleaned up state for intent 0x953a61fe9c1f745828942c30caa2081c3702931c142417508c906e8bc76e2c5d
