

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ” MPC-BASED ORDER SPLITTING SERVER ğŸ”               â•‘
â•‘     Privacy-Preserving DEX Liquidity Coordination             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‚ Loaded existing wallet for node0.veil

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                       WALLET INFORMATION                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Node Name:     node0.veil                                  â•‘
â•‘ Address:       0xC67ef54A950320D1F226a225DFffD467E7991a1E  â•‘
â•‘ Private Key:   0x4f00c05cbfaa95b17e...1683639a610f12c1310a    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  Keep your private key secure! Anyone with access can control your funds.

Configuration validated successfully

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  MPC SERVER CONFIGURATION                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Node Name:     node0.veil                                  â•‘
â•‘ Party ID:      0                                           â•‘
â•‘ Network:       localhost:3668                              â•‘
â•‘ Wallet:        0xC67ef54A950320D1F226a225DFffD467E7991a1E  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ BLOCKCHAIN                                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Chain ID:      84532                                       â•‘
â•‘ RPC URL:       https://base-sepolia.g.alchemy.com/v2/wfTWOqX-tfO2ahOiD3rCXzscObxKVms-â•‘
â•‘ Settlement:    0x56053B0ed4BB1b493c2B15FFa4BA21AF3d1492E4  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ NETWORK PEERS                                                 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Party 0: node0.veil (YOU)                                    â•‘
â•‘ Party 1: node1.veil                                          â•‘
â•‘ Party 2: node2.veil                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ INITIAL CAPACITIES                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ (none configured)                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â³ Blockchain address for party 1 will be received via P2P
â³ Blockchain address for party 2 will be received via P2P
ğŸ”Œ Using WebSocket for real-time event listening
ğŸ”„ Auto-swap enabled via Uniswap
Starting MPC Server (Party 0)...
âœ… Node registered with Settlement contract: 0xC67ef54A950320D1F226a225DFffD467E7991a1E
WebSocket server listening on port 3668
Error connecting to party 1: AggregateError [ECONNREFUSED]: 
    at internalConnectMultiple (node:net:1134:18)
    at afterConnectMultiple (node:net:1715:7) {
  code: 'ECONNREFUSED',
  [errors]: [
    Error: connect ECONNREFUSED ::1:3534
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -61,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3534
    },
    Error: connect ECONNREFUSED 127.0.0.1:3534
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -61,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3534
    }
  ]
}
Error connecting to party 2: AggregateError [ECONNREFUSED]: 
    at internalConnectMultiple (node:net:1134:18)
    at afterConnectMultiple (node:net:1715:7) {
  code: 'ECONNREFUSED',
  [errors]: [
    Error: connect ECONNREFUSED ::1:3145
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -61,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3145
    },
    Error: connect ECONNREFUSED 127.0.0.1:3145
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -61,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3145
    }
  ]
}
Connected to 0/2 parties
P2P network started for party 0
Starting to listen for IntentCreated events at 0x56053B0ed4BB1b493c2B15FFa4BA21AF3d1492E4
Event listener started
MPC Server started successfully
Connections: 0/2
âœ… Server is running and listening for intents
ğŸ’¡ Press Ctrl+C to stop

Incoming connection from: 127.0.0.1
Identified incoming connection as party 1
Received HANDSHAKE_RESPONSE from party 1
Incoming connection from: 127.0.0.1
Identified incoming connection as party 2
Received HANDSHAKE_RESPONSE from party 2
IntentCreated event: {
  intentId: '0x8cd16326e860dea0624fdcae2c2c614dabf3fad2d37824400e8a14bdfad58c80',
  user: '0x89fEdB2167197199Fd069122e5351A1C779F91B8',
  amountIn: '1000000000000000'
}

=== New Intent Created ===
Intent ID: 0x8cd16326e860dea0624fdcae2c2c614dabf3fad2d37824400e8a14bdfad58c80
Amount In: 1000000000000000
Token In: 0x4200000000000000000000000000000000000006
Token Out: 0x0000000000000000000000000000000000000001
No capacity for 0x4200000000000000000000000000000000000006, attempting to swap from other tokens...

ğŸ¯ Attempting to fulfill requirement:
  Token: 0x4200000000000000000000000000000000000006
  Amount: 333333333333333
  âŒ No suitable source token found for swapping
âŒ Could not swap to obtain 0x4200000000000000000000000000000000000006
No capacity for this token, participating with 0...

=== Starting MPC Protocol ===
Step 1: Secret sharing capacity...
Step 2: Distributing shares...
Step 3: Waiting for shares from other parties...
Received SHARE_DISTRIBUTION from party 1
Received shares from party 1 for intent 0x8cd16326e860dea0624fdcae2c2c614dabf3fad2d37824400e8a14bdfad58c80
Received SHARE_DISTRIBUTION from party 2
Received shares from party 2 for intent 0x8cd16326e860dea0624fdcae2c2c614dabf3fad2d37824400e8a14bdfad58c80
Step 4: Computing total capacity (on shares)...
Step 5: Checking sufficient capacity...
Received COMPUTATION_ROUND from party 1
Received computation round 1 from party 1
Received COMPUTATION_ROUND from party 2
Received computation round 1 from party 2
Warning: Got 6 unique shares instead of expected 3
Share counts: 57273119094834598091387775697731005801239710793438018741957323017459698724681: 1, 110349803512835962225982227505050658126262795256935391498905493734131790511075: 1, 88072717088982393639207411124561991839108119511434302037570248807654458601705: 1, 108620970515541069676972897928462365609624938749560533502447231068762834183839: 1, 50776562984656273548084937375899836448789680220370134595945102451879348385561: 1, 31349340652016720930847967683788257373339521256167985119873724597856592477559: 1
Shares not replicated (all parties likely have 0 capacity), reconstructing by direct sum
Sufficient capacity: true
Step 6: Computing allocations...
My capacity is 0, skipping reconstruction (zero allocation)
My allocation: 0
Step 7: Signing settlement...
Step 8: Broadcasting signature...
Step 9: Waiting for all signatures...
Error in MPC protocol: Error: Timeout waiting for signatures
    at MPCServer.waitForAllSignatures (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:610:15)
    at async MPCServer.runMPCProtocol (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:342:13)
    at async MPCServer.handleIntentCreated (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:223:9)
    at async file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/server.js:177:13
    at async BlockchainEventListener.handleIntentCreated (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/blockchain/events.js:100:17)
    at async onLogs (file:///Users/vanshsahay/coding/projects/hack-money/packages/node/dist/blockchain/events.js:65:25)
Cleaned up state for intent 0x8cd16326e860dea0624fdcae2c2c614dabf3fad2d37824400e8a14bdfad58c80
